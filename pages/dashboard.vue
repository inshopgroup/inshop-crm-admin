<template>
  <v-container fluid>
    <v-row justify="space-between">
      <v-col>
        <is-title title="dashboard_title"></is-title>
      </v-col>
    </v-row>

    <v-row>
      <v-col md="6" sm="12">
        <bar-box :title="$t('clients_30')" :data="data.clients_30"></bar-box>
      </v-col>
      <v-col md="6" sm="12">
        <bar-box :title="$t('events_30')" :data="data.events_30"></bar-box>
      </v-col>
    </v-row>

    <v-row>
      <v-col md="4" sm="6" xs="12">
        <doughnut-box :title="$t('user_7')" :data="data.user_7"></doughnut-box>
      </v-col>
      <v-col md="4" sm="6" xs="12">
        <doughnut-box
          :title="$t('user_30')"
          :data="data.user_30"
        ></doughnut-box>
      </v-col>
      <v-col md="4" sm="6" xs="12">
        <doughnut-box
          :title="$t('user_365')"
          :data="data.user_365"
        ></doughnut-box>
      </v-col>
      <v-col md="4" sm="6" xs="12">
        <doughnut-box
          :title="$t('user_time_7')"
          :data="data.user_time_7"
        ></doughnut-box>
      </v-col>
      <v-col md="4" sm="6" xs="12">
        <doughnut-box
          :title="$t('user_time_30')"
          :data="data.user_time_30"
        ></doughnut-box>
      </v-col>
      <v-col md="4" sm="6" xs="12">
        <doughnut-box
          :title="$t('user_time_365')"
          :data="data.user_time_365"
        ></doughnut-box>
      </v-col>
    </v-row>
  </v-container>
</template>

<script>
import BarBox from '../components/chart/box/BarBox'
import DoughnutBox from '../components/chart/box/DoughnutBox'

export default {
  components: {
    DoughnutBox,
    BarBox,
  },
  layout: 'dashboard',
  middleware: 'authenticated',
  data() {
    return {
      data: {},
    }
  },
  head() {
    return {
      title: 'Homepage title',
    }
  },
  mounted() {
    if (!this.isGranted('ROLE_USER_DASHBOARD')) {
      this.$router.push('/')
    }

    this.getData()
  },
  methods: {
    getData() {
      const url = `${process.env.NUXT_ENV_API_URL}/users/dashboard`

      this.$axios.get(url).then((response) => {
        this.data = response.data['hydra:member'][0]
      })
    },
  },
}
</script>
